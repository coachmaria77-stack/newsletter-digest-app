<!DOCTYPE html>                                                                                             
  <html lang="en">                                                                                            
  <head>                                                                                                      
      <meta charset="UTF-8">                                                                                  
      <meta name="viewport" content="width=device-width, initial-scale=1.0">                                  
      <title>Newsletter Digest App</title>                                                                    
      <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">                        
  </head>                                                                                                     
  <body>                                                                                                      
      <div class="container">                                                                                 
          <header>                                                                                            
              <h1>üì∞ Newsletter Digest App</h1>                                                               
              <p class="subtitle">Your daily news digest, deduplicated and summarized</p>                     
          </header>                                                                                           
                                                                                                              
          <div class="dashboard">                                                                             
              <!-- Configuration Status -->                                                                   
              <div class="card">                                                                              
                  <h2>‚öôÔ∏è Configuration Status</h2>                                                            
                  <div class="status-grid">                                                                   
                      <div class="status-item">                                                               
                          <span class="label">Email Configured:</span>                                        
                          <span class="value {{ 'success' if config['email_address'] else 'error' }}">        
                              {{ '‚úì Yes' if config['email_address'] else '‚úó No' }}                            
                          </span>                                                                             
                      </div>                                                                                  
                      <div class="status-item">                                                               
                          <span class="label">OpenAI API:</span>                                              
                          <span class="value {{ 'success' if config['openai_api_key'] else 'warning' }}">     
                              {{ '‚úì Configured' if config['openai_api_key'] else '‚ö† Not configured (will use  
  fallback)' }}                                                                                               
                          </span>                                                                             
                      </div>                                                                                  
                      <div class="status-item">                                                               
                          <span class="label">Email Address:</span>                                           
                          <span class="value">{{ config['email_address'] or 'Not set' }}</span>               
                      </div>                                                                                  
                      <div class="status-item">                                                               
                          <span class="label">Digest Recipient:</span>                                        
                          <span class="value">{{ config['digest_recipient'] or config['email_address'] or 'Not
   set' }}</span>                                                                                             
                      </div>                                                                                  
                      <div class="status-item">                                                               
                          <span class="label">Daily Schedule:</span>                                          
                          <span class="value">{{ '%02d:%02d' % (config['digest_hour'],                        
  config['digest_minute']) }}</span>                                                                          
                      </div>                                                                                  
                      <div class="status-item">                                                               
                          <span class="label">Scheduler Status:</span>                                        
                          <span class="value {{ 'success' if scheduler_running else 'error' }}">              
                              {{ '‚úì Running' if scheduler_running else '‚úó Stopped' }}                         
                          </span>                                                                             
                      </div>                                                                                  
                  </div>                                                                                      
              </div>                                                                                          
                                                                                                              
              <!-- Last Run Status -->                                                                        
              <div class="card">                                                                              
                  <h2>üìä Last Run Status</h2>                                                                 
                  <div class="status-grid">                                                                   
                      <div class="status-item">                                                               
                          <span class="label">Last Run:</span>                                                
                          <span class="value">                                                                
                              {% if last_run['timestamp'] %}                                                  
                                  {{ last_run['timestamp'] }}                                                 
                              {% else %}                                                                      
                                  Never                                                                       
                              {% endif %}                                                                     
                          </span>                                                                             
                      </div>                                                                                  
                      <div class="status-item">                                                               
                          <span class="label">Status:</span>                                                  
                          <span class="value status-{{ last_run['status'].lower().replace(' ', '-') }}">      
                              {{ last_run['status'] }}                                                        
                          </span>                                                                             
                      </div>                                                                                  
                      <div class="status-item">                                                               
                          <span class="label">Newsletters Found:</span>                                       
                          <span class="value">{{ last_run['newsletter_count'] }}</span>                       
                      </div>                                                                                  
                      <div class="status-item">                                                               
                          <span class="label">Unique Articles:</span>                                         
                          <span class="value">{{ last_run['article_count'] }}</span>                          
                      </div>                                                                                  
                      {% if last_run['error'] %}                                                              
                      <div class="status-item full-width">                                                    
                          <span class="label">Error:</span>                                                   
                          <span class="value error">{{ last_run['error'] }}</span>                            
                      </div>                                                                                  
                      {% endif %}                                                                             
                  </div>                                                                                      
              </div>                                                                                          
                                                                                                              
              <!-- Actions -->                                                                                
              <div class="card">                                                                              
                  <h2>üéØ Actions</h2>                                                                         
                  <div class="actions">                                                                       
                      <button id="testConnection" class="btn btn-secondary">                                  
                          Test Email Connection                                                               
                      </button>                                                                               
                      <button id="triggerNow" class="btn btn-primary">                                        
                          Generate Digest Now                                                                 
                      </button>                                                                               
                      <button id="triggerWeek" class="btn btn-secondary">                                     
                          Generate Digest (Last 7 Days)                                                       
                     </button>                                                                                
                      <button id="refreshStatus" class="btn btn-secondary">                                   
                          Refresh Status                                                                      
                      </button>                                                                               
                      <button onclick="window.location.href='/history'" class="btn btn-secondary">            
                          View History                                                                        
                      </button>                                                                               
                  </div>                                                                                      
                  <div id="actionStatus" class="action-status"></div>
            </div>

            <!-- Newsletter Management -->
            <div class="card">
                <h2>üìß Newsletter Senders</h2>
                <div class="newsletter-section">
                    <div class="add-newsletter-form">
                        <input type="email" id="newsletterEmail" placeholder="sender@newsletter.com" class="input-field">
                        <input type="text" id="newsletterName" placeholder="Newsletter name (optional)" class="input-field">
                        <button id="addNewsletter" class="btn btn-primary">Add Newsletter</button>
                    </div>
                    <div id="newsletterList" class="newsletter-list">
                        <p>Loading newsletters...</p>
                    </div>
                </div>
            </div>

            <!-- View Digest -->                                                                            
              <div class="card">                                                                              
                  <h2>üì∞ Your Latest Digest</h2>                                                              
                  <div class="instructions">                                                                  
                      <p>Your digest will appear below after you generate it:</p>                             
                      <div class="actions">                                                                   
                          <button id="loadDigest" class="btn btn-primary">                                    
                              Load Digest                                                                     
                          </button>                                                                           
                      </div>                                                                                  
                      <div id="digestContent" style="margin-top: 20px; display: none;">                       
                          <iframe id="digestFrame" style="width: 100%; min-height: 800px; border: 1px solid   
  #e0e0e0; border-radius: 8px;"></iframe>                                                                     
                      </div>                                                                                  
                  </div>                                                                                      
              </div>                                                                                          
          </div>                                                                                              
      </div>                                                                                                  
      <script src="{{ url_for('static', filename='js/app.js') }}"></script>                                   
  </body>                                                                                                     
  </html>    
